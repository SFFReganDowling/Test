(window.webpackJsonpweatherclock=window.webpackJsonpweatherclock||[]).push([[0],{39:function(e,t,n){e.exports=n(54)},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(11),i=n.n(o),c=(n(44),n(6)),s=n(7),l=n(8),u=n(9),m=(n(45),n(16)),p=(n(46),n(32)),h=(n(47),function e(t){var n=this;if(Object(c.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(n.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(n.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(n.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(n.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var r=2*Math.PI*(n.decimalHour/12);return Math.sin(r)*e-(t-1)/2},this.symbolDy=function(e,t){var r=2*Math.PI*(n.decimalHour/12);return-Math.cos(r)*e-(t-1)/2},this.isNight=function(){return n.decimalHour<7||n.decimalHour>20},this._degreesDistance=function(e,t){var n=Math.abs(t-e);return n>180?360-n:n},this.rankFreeDirections=function(){var e=[0,90,180,270],t=n.decimalHour%1*360,r=n.decimalHour%12/12*360,a={};return e.forEach(function(e){var o=n._degreesDistance(e,t),i=n._degreesDistance(e,r);a[e]=Math.min(o,i)}),e.sort(function(e,t){var n=a[e],r=a[t];return n<r?1:n>r?-1:0}),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60}}),d=39,g=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e=0|n.props.degreesCelsius,t=n.props.coordinates.hourDx(d),r=n.props.coordinates.hourDy(d);return a.a.createElement("text",{className:"hour",x:t,y:r},e,"\xb0")},n}return Object(u.a)(t,e),t}(a.a.Component),f=29,w=10,v=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+n.props.symbol+";content_type=image/png;is_night="+(n.props.coordinates.isNight()?1:0),t=n.props.coordinates.symbolDx(f,w),r=n.props.coordinates.symbolDy(f,w);return a.a.createElement("image",{className:"symbol",x:t,y:r,width:w,height:w,href:e})},n}return Object(u.a)(t,e),t}(a.a.Component),b=(n(48),13),y=1.2,E=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).state={textWidth:0,textHeight:0},n.componentDidMount=function(){var e=n.textRef.current.getBBox();n.setState({textWidth:e.width,textHeight:e.height})},n.render=function(){var e=n.props.coords.hourDx(b),t=n.props.coords.hourDy(b),r=n.state.textWidth*y,o=n.state.textHeight*y;return a.a.createElement(a.a.Fragment,null,a.a.createElement("rect",{x:e-r/2,y:t-o/2,width:r,height:o,rx:"2",ry:"2",className:"wind"}),a.a.createElement("text",{ref:n.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},n.props.children))},n.textRef=a.a.createRef(),n}return Object(u.a)(t,e),t}(a.a.Component),x=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).renderTemperatures=function(e){return e.filter(function(e){return void 0!==e.celsius}).map(function(e){var t=new h(e.timestamp);return a.a.createElement(g,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})})},n.renderWeathers=function(e){return e.filter(function(e){return void 0!==e.symbol}).map(function(e){var t=new h(e.timestamp);return a.a.createElement(v,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})})},n.renderWindAndPrecipitation=function(e){var t=0,r=null,o=null;e.forEach(function(e){(null==r||r>e.wind_m_s)&&(r=e.wind_m_s),(null==o||o<e.wind_m_s)&&(o=e.wind_m_s),void 0!==e.precipitation_mm&&(t+=e.precipitation_mm)}),r=Math.round(r),o=Math.round(o);var i=r===o?"".concat(r," m/s"):"".concat(r,"-").concat(o," m/s");console.log("Wind: ".concat(i));var c=navigator.language||navigator.userLanguage,s=new Intl.NumberFormat(c,{minimumSignificantDigits:2}).format(t),l="".concat(s,"mm");console.log("Precipitation: ".concat(l));var u=new h(n.props.now).rankFreeDirections(),m=u[0],p=new h(12*m/360),d=u[1],g=new h(12*d/360);return a.a.createElement(a.a.Fragment,null,a.a.createElement(E,{coords:p},i),a.a.createElement(E,{coords:g},l))},n.getForecastsToRender=function(){for(var e=[],t=n.props.now.getTime(),r=new Date(t+27e5),a=new Date(t+423e5),o=0,i=Object.entries(n.props.forecast);o<i.length;o++){var c=i[o],s=Object(p.a)(c,2),l=s[0],u=s[1],m=new Date(l);m<r||(m>a||e.push(u))}return console.log(e),e},n.render=function(){var e=n.getForecastsToRender();return a.a.createElement(a.a.Fragment,null,n.renderTemperatures(e),n.renderWeathers(e),n.renderWindAndPrecipitation(e))},n}return Object(u.a)(t,e),t}(a.a.Component),D=(n(49),function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:n.props.dx,y2:n.props.dy,strokeWidth:n.props.width}),a.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),a.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:n.props.dx,y2:n.props.dy,strokeWidth:n.props.width}),a.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},n}return Object(u.a)(t,e),t}(a.a.Component)),j=n(79),O=n(75),k=n(76),_=n(77),N=n(78),H=n(80),M=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return a.a.createElement(j.a,{open:!0,onClose:n.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(O.a,{id:"alert-dialog-title"},n.props.title),a.a.createElement(k.a,null,a.a.createElement(_.a,{id:"alert-dialog-description"},n.props.children)),a.a.createElement(N.a,null,a.a.createElement(H.a,{onClick:n.props.reload,color:"primary",autoFocus:!0},"Retry")))},n}return Object(u.a)(t,e),t}(a.a.Component),T=23,C=34,F=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e)))._getInitialState=function(){return navigator.geolocation?{now:n.props.now,position:null,progress:null,forecast:null,error:null}:{now:n.props.now,position:null,progress:null,forecast:null,error:a.a.createElement(M,{title:"Geolocation unsupported",reload:n.props.reload},"Your browser does not support geolocation. Without knowing your current position, showing your local weather forecast is not possible.",a.a.createElement("p",null,"Please try another browser."))}},n.componentDidMount=function(){n.state.position||n.state.progress||n.state.error||(console.log("Geolocating..."),n.setState({progress:a.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(n.setPosition,n.geoError))},n.componentDidUpdate=function(){n.props.now!==n.state.now&&n.setState(n._getInitialState()),n.state.position||n.state.progress||n.state.error||(console.log("Geolocating..."),n.setState({progress:a.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(n.setPosition,n.geoError))},n.setPosition=function(e){var t=e.coords.latitude,r=e.coords.longitude;console.log("got position: ".concat(t," ").concat(r)),n.setState({progress:a.a.createElement("text",{className:"progress"},"Downloading weather..."),position:e.coords}),n.download_weather(t,r)},n.download_weather=function(e,t){var r="https://api-met-no-proxy.appspot.com/weatherapi/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+r);var o=Object(m.a)(n);fetch(r).then(function(e){if(!e.ok)throw new M("Response code from upstream: ".concat(e.status));return e.text()}).then(function(e){var t=o.parseWeatherXml(e);o.setState({forecast:t})}).catch(function(e){n.setState({error:a.a.createElement(M,{title:"Downloading weather failed",reload:n.props.reload},e.message)})})},n.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var n={},r=0;r<t.length;r++){var a=t[r],o=new Date(a.attributes.from.value),i=new Date(a.attributes.to.value),c=(i.getTime()-o.getTime())/36e5,s=new Date((o.getTime()+i.getTime())/2),l=n[s];if(l||(l={}),l.timestamp=s,!(void 0!==l.span_h&&l.span_h<=c)){l.span_h=c;var u=a.getElementsByTagName("symbol");if(u&&u.length>0){var m=u[0].attributes.number.value;l.symbol=m}var p=a.getElementsByTagName("temperature");if(p&&p.length>0){var h=p[0].attributes.value.value;l.celsius=parseFloat(h)}var d=a.getElementsByTagName("windSpeed");if(d&&d.length>0){var g=d[0].attributes.mps.value;l.wind_m_s=parseFloat(g)}var f=a.getElementsByTagName("precipitation");if(f&&f.length>0){var w=f[0].attributes.value.value;l.precipitation_mm=parseFloat(w)}n[s]=l}}return n},n.geoError=function(e){console.log("Geolocation failed"),n.setState({error:a.a.createElement(M,{title:e.message,reload:window.location.reload.bind(window.location,[!0])},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},n.renderHands=function(){var e=new h(n.state.now);return a.a.createElement(a.a.Fragment,null,a.a.createElement(D,{width:2.5,dx:e.hourDx(T),dy:e.hourDy(T)}),a.a.createElement(D,{width:2,dx:e.minuteDx(C),dy:e.minuteDy(C)}))},n.render=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},a.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"clock-frame.png"}),n.getClockContents()),n.state.error)},n.getClockContents=function(){return n.state.error?n.renderHands():n.state.forecast?a.a.createElement(a.a.Fragment,null,a.a.createElement(x,{forecast:n.state.forecast,now:n.state.now}),n.renderHands()):n.state.progress?n.state.progress:null},n.state=n._getInitialState(),n}return Object(u.a)(t,e),t}(a.a.Component),P=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={now:new Date},n.setTimeToNow=function(){n.setState({now:new Date})},n.render=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(F,{now:n.state.now,reload:n.setTimeToNow}),a.a.createElement("button",{type:"button",onClick:n.setTimeToNow},"Update forecast"),a.a.createElement("p",null,"Weather forecast from ",a.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",a.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," and the"," ",a.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),a.a.createElement("p",null,"Imagine a share-on-Facebook button here"),a.a.createElement("p",null,a.a.createElement("a",{href:"https://github.com/walles/weatherclock"},"Source code on GitHub")))},n}return Object(u.a)(t,e),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var W=window.location.protocol;"http:"===W&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(W.length):(i.a.render(a.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[39,1,2]]]);
//# sourceMappingURL=main.ec79e373.chunk.js.map