(window.webpackJsonpweatherclock=window.webpackJsonpweatherclock||[]).push([[0],{41:function(e,t,a){e.exports=a(56)},46:function(e,t,a){},47:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},53:function(e,t,a){},56:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(13),i=a.n(r),s=(a(46),a(6)),c=a(8),l=a(9),u=a(10),m=(a(47),a(16)),d=a(24),p=(a(50),a(34)),h=(a(51),function e(t){var a=this;if(Object(s.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(a.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(a.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(a.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(a.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return Math.sin(n)*e-(t-1)/2},this.symbolDy=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return-Math.cos(n)*e-(t-1)/2},this.isNight=function(){return a.decimalHour<7||a.decimalHour>20},this._degreesDistance=function(e,t){var a=Math.abs(t-e);return a>180?360-a:a},this.rankFreeDirections=function(){var e=[0,90,180,270],t=a.decimalHour%1*360,n=a.decimalHour%12/12*360,o={};return e.forEach(function(e){var r=a._degreesDistance(e,t),i=a._degreesDistance(e,n);o[e]=Math.min(r,i)}),e.sort(function(e,t){var a=o[e],n=o[t];return a<n?1:a>n?-1:0}),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60+t.getSeconds()/3600}}),w=39,f=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).render=function(){var e=0|a.props.degreesCelsius,t=a.props.coordinates.hourDx(w),n=a.props.coordinates.hourDy(w);return o.a.createElement("text",{className:"hour",x:t,y:n},e,"\xb0")},a}return Object(u.a)(t,e),t}(o.a.Component),g=29,v=10,b=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).render=function(){var e="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+a.props.symbol+";content_type=image/png;is_night="+(a.props.coordinates.isNight()?1:0),t=a.props.coordinates.symbolDx(g,v),n=a.props.coordinates.symbolDy(g,v);return o.a.createElement("image",{className:"symbol",x:t,y:n,width:v,height:v,href:e})},a}return Object(u.a)(t,e),t}(o.a.Component),y=(a(52),13),E=1.2,x=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).state={textWidth:0,textHeight:0},a.componentDidMount=function(){var e=a.textRef.current.getBBox();a.setState({textWidth:e.width,textHeight:e.height})},a.render=function(){var e=a.props.coords.hourDx(y),t=a.props.coords.hourDy(y),n=a.state.textWidth*E,r=a.state.textHeight*E;return o.a.createElement(o.a.Fragment,null,o.a.createElement("rect",{x:e-n/2,y:t-r/2,width:n,height:r,rx:"2",ry:"2",className:"wind"}),o.a.createElement("text",{ref:a.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},a.props.children))},a.textRef=o.a.createRef(),a}return Object(u.a)(t,e),t}(o.a.Component),D=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).renderTemperatures=function(e){return e.filter(function(e){return void 0!==e.celsius}).map(function(e){var t=new h(e.timestamp);return o.a.createElement(f,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})})},a.renderWeathers=function(e){return e.filter(function(e){return void 0!==e.symbol}).map(function(e){var t=new h(e.timestamp);return o.a.createElement(b,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})})},a.renderWindAndPrecipitation=function(e){var t=0,n=null,r=null;e.forEach(function(e){(null==n||n>e.wind_m_s)&&(n=e.wind_m_s),(null==r||r<e.wind_m_s)&&(r=e.wind_m_s),void 0!==e.precipitation_mm&&(t+=e.precipitation_mm)}),n=Math.round(n),r=Math.round(r);var i=n===r?"".concat(n," m/s"):"".concat(n,"-").concat(r," m/s");console.debug("Wind: ".concat(i));var s=navigator.language||navigator.userLanguage,c=new Intl.NumberFormat(s,{minimumFractionDigits:1,maximumFractionDigits:1}).format(t),l="".concat(c,"mm");console.debug("Precipitation: ".concat(l));var u=new h(a.props.now).rankFreeDirections(),m=u[0],d=new h(12*m/360),p=u[1],w=new h(12*p/360);return o.a.createElement(o.a.Fragment,null,o.a.createElement(x,{coords:d},i),o.a.createElement(x,{coords:w},l))},a.getForecastsToRender=function(){for(var e=[],t=a.props.now.getTime(),n=new Date(t+27e5),o=new Date(t+423e5),r=0,i=Object.entries(a.props.forecast);r<i.length;r++){var s=i[r],c=Object(p.a)(s,2),l=c[0],u=c[1],m=new Date(l);m<n||(m>o||e.push(u))}return console.debug(e),e},a.render=function(){var e=a.getForecastsToRender();return o.a.createElement(o.a.Fragment,null,a.renderTemperatures(e),a.renderWeathers(e),a.renderWindAndPrecipitation(e))},a}return Object(u.a)(t,e),t}(o.a.Component),O=(a(53),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).render=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:a.props.dx,y2:a.props.dy,strokeWidth:a.props.width}),o.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),o.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:a.props.dx,y2:a.props.dy,strokeWidth:a.props.width}),o.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},a}return Object(u.a)(t,e),t}(o.a.Component)),j=a(86),T=a(82),M=a(83),C=a(84),N=a(85),_=a(88),k=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).render=function(){return o.a.createElement(j.a,{open:!0,onClose:a.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(T.a,{id:"alert-dialog-title"},a.props.title),o.a.createElement(M.a,null,o.a.createElement(C.a,{id:"alert-dialog-description"},a.props.children)),o.a.createElement(N.a,null,o.a.createElement(_.a,{onClick:a.props.reload,color:"primary",autoFocus:!0},"Retry")))},a}return Object(u.a)(t,e),t}(o.a.Component),S=a(87),H=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).render=function(){return o.a.createElement(S.a,{style:{position:"absolute",right:"0px",top:"0px"},value:a.props.value,onChange:a.onChange},o.a.createElement("option",{value:"now"},"Now"),o.a.createElement("option",{value:"tomorrow"},"Tomorrow"))},a.onChange=function(e){a.props.onSetTimespan(e.target.value)},a}return Object(u.a)(t,e),t}(o.a.Component),F=23,I=34,P=3e5,W=72e5,A=5,B=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e)))._getInitialState=function(){return navigator.geolocation?{now:a.props.now,progress:null,error:null}:(d.a.exception({description:"Geolocation unsupported",fatal:!0}),{now:a.props.now,progress:null,error:o.a.createElement(k,{title:"Geolocation unsupported",reload:a.props.reload},"Please try ",o.a.createElement("a",{href:"https://getfirefox.com"},"another browser"),".")})},a.componentDidMount=function(){a.startGeolocationIfNeeded()},a.componentDidUpdate=function(){a.props.now!==a.state.now&&a.setState(a._getInitialState()),a.startGeolocationIfNeeded()||a.state.progress||a.forecastIsCurrent()||a.download_weather()},a.startGeolocationIfNeeded=function(){if(a.state.progress)return!1;if(a.state.error)return!1;if(a.state.position){var e=new Date-a.state.positionTimestamp;if(e<P)return console.debug("Retaining cached position of ".concat(e,"ms age")),!1}return console.log("Geolocating..."),a.setState({progress:o.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(a.setPosition,a.geoError),!0},a.setPosition=function(e){var t=e.coords.latitude,n=e.coords.longitude;console.log("got position: ".concat(t," ").concat(n)),a.setState({position:e.coords,positionTimestamp:new Date}),a.forecastIsCurrent()||a.download_weather()},a.getDistanceFromLatLonInKm=function(e,t,n,o){var r=a.deg2rad(n-e),i=a.deg2rad(o-t),s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a.deg2rad(e))*Math.cos(a.deg2rad(n))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},a.deg2rad=function(e){return e*(Math.PI/180)},a.forecastIsCurrent=function(){if(!a.state.forecast)return!1;var e=a.state.forecastMetadata,t=new Date-e.timestamp;if(t>W)return!1;var n=a.getDistanceFromLatLonInKm(e.latitude,e.longitude,a.state.position.latitude,a.state.position.longitude);return!(n>A)&&(console.debug("Forecast considered current: ".concat(t,"ms old and ").concat(n,"km away")),!0)},a.download_weather=function(){var e=a.state.position.latitude,t=a.state.position.longitude;a.setState({progress:o.a.createElement("text",{className:"progress"},"Downloading weather...")});var n="https://api-met-no-proxy.appspot.com/weatherapi/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+n);var r=Object(m.a)(a);fetch(n).then(function(e){if(!e.ok)throw new k("Response code from upstream: ".concat(e.status));return e.text()}).then(function(a){var n=r.parseWeatherXml(a);r.setState({forecast:n,forecastMetadata:{timestamp:new Date,latitude:e,longitude:t}})}).catch(function(e){d.a.exception({description:"Downloading weather failed: ".concat(e.message),fatal:!a.state.forecast}),a.setState({error:o.a.createElement(k,{title:"Downloading weather failed",reload:a.props.reload},e.message)})})},a.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var a={},n=0;n<t.length;n++){var o=t[n],r=new Date(o.attributes.from.value),i=new Date(o.attributes.to.value),s=(i.getTime()-r.getTime())/36e5,c=new Date((r.getTime()+i.getTime())/2),l=a[c];if(l||(l={}),l.timestamp=c,!(void 0!==l.span_h&&l.span_h<=s)){l.span_h=s;var u=o.getElementsByTagName("symbol");if(u&&u.length>0){var m=u[0].attributes.number.value;l.symbol=m}var d=o.getElementsByTagName("temperature");if(d&&d.length>0){var p=d[0].attributes.value.value;l.celsius=parseFloat(p)}var h=o.getElementsByTagName("windSpeed");if(h&&h.length>0){var w=h[0].attributes.mps.value;l.wind_m_s=parseFloat(w)}var f=o.getElementsByTagName("precipitation");if(f&&f.length>0){var g=f[0].attributes.maxvalue,v=f[0].attributes.value,b=void 0===g?v.value:g.value;l.precipitation_mm=parseFloat(b)}a[c]=l}}return console.log(a),a},a.geoError=function(e){console.log("Geolocation failed"),d.a.exception({description:"Geolocation failed: ".concat(e.message),fatal:!a.state.forecast}),a.setState({error:o.a.createElement(k,{title:e.message,reload:window.location.reload.bind(window.location,[!0])},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},a.renderHands=function(){var e=new h(a.state.now);return o.a.createElement(o.a.Fragment,null,o.a.createElement(O,{width:2.5,dx:e.hourDx(F),dy:e.hourDy(F)}),o.a.createElement(O,{width:2,dx:e.minuteDx(I),dy:e.minuteDy(I)}))},a.render=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},o.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"clock-frame.png"}),a.getClockContents()),a.state.error,a.state.forecast?o.a.createElement(H,{value:a.props.nowOrTomorrow,onSetTimespan:a.props.onSetTimespan}):null)},a.getClockContents=function(){return a.state.forecast?"tomorrow"===a.props.nowOrTomorrow?o.a.createElement(o.a.Fragment,null,o.a.createElement(D,{forecast:a.state.forecast,now:a.state.now}),o.a.createElement("text",{className:"tomorrow"},"Tomorrow")):o.a.createElement(o.a.Fragment,null,o.a.createElement(D,{forecast:a.state.forecast,now:a.state.now}),a.renderHands()):a.state.error?a.renderHands():a.state.progress?a.state.progress:null},a.state=a._getInitialState(),a}return Object(u.a)(t,e),t}(o.a.Component),G=a(33);d.a.initialize("UA-59702036-2",{gaOptions:{anonymizeIp:!0}}),d.a.pageview(window.location.pathname+window.location.search);var R=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={now:new Date,nowOrTomorrow:"now"},a.setTimeToNow=function(){a.setState({now:new Date,nowOrTomorrow:"now"})},a.handleVisibilityChange=function(e){console.debug("Page visibility changed: ".concat(e)),e&&a.setTimeToNow()},a.onSetTimespan=function(e){if("now"===e)a.setState({nowOrTomorrow:"now",now:new Date});else{var t=new Date;t.setDate(t.getDate()+1),t.setHours(7),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),a.setState({nowOrTomorrow:"tomorrow",now:t})}},a.render=function(){return o.a.createElement(G.a,{onChange:a.handleVisibilityChange},o.a.createElement("div",{className:"App"},o.a.createElement(B,{now:a.state.now,reload:a.setTimeToNow,onSetTimespan:a.onSetTimespan,nowOrTomorrow:a.state.nowOrTomorrow}),o.a.createElement("button",{type:"button",onClick:a.setTimeToNow},"Update forecast"),o.a.createElement("p",null,"Weather forecast from ",o.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",o.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," and the"," ",o.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),o.a.createElement("p",null,o.a.createElement("a",{href:"https://github.com/walles/weatherclock/tree/".concat("5256b70ff23577355bc6e82077e049df123045df")},"Source code on GitHub"))))},a}return Object(u.a)(t,e),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var L=window.location.protocol;"http:"===L&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(L.length):(i.a.render(o.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[41,1,2]]]);
//# sourceMappingURL=main.c010301e.chunk.js.map