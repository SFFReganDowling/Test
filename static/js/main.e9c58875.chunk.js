(this.webpackJsonpweatherclock=this.webpackJsonpweatherclock||[]).push([[0],{44:function(e,t,a){e.exports=a(64)},49:function(e,t,a){},55:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(12),i=a.n(o),s=(a(49),a(6)),c=a(9),l=a(8),m=a(32),u=a.n(m),d=(a(55),a(26)),p=a(20),h=(a(58),a(37)),g=a(33),f=(a(59),function e(t){var a=this;if(Object(s.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(a.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(a.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(a.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(a.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var r=2*Math.PI*(a.decimalHour/12);return Math.sin(r)*e-(t-1)/2},this.symbolDy=function(e,t){var r=2*Math.PI*(a.decimalHour/12);return-Math.cos(r)*e-(t-1)/2},this.isNight=function(){return a.decimalHour<7||a.decimalHour>20},this._degreesDistance=function(e,t){var a=Math.abs(t-e);return a>180?360-a:a},this.rankFreeDirections=function(){var e=[0,90,180,270],t=a.decimalHour%1*360,r=a.decimalHour%12/12*360,n={};return e.forEach((function(e){var o=a._degreesDistance(e,t),i=a._degreesDistance(e,r);n[e]=Math.min(o,i)})),e.sort((function(e,t){var a=n[e],r=n[t];return a<r?1:a>r?-1:0})),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60+t.getSeconds()/3600}}),w=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){var t=0|e.props.degreesCelsius,a=e.props.coordinates.hourDx(39),r=e.props.coordinates.hourDy(39);return n.a.createElement("text",{className:"hour",x:a,y:r},t,"\xb0")},e}return a}(n.a.Component),v=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){var t="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+e.props.symbol+";content_type=image/png;is_night="+(e.props.coordinates.isNight()?1:0),a=e.props.coordinates.symbolDx(29,10),r=e.props.coordinates.symbolDy(29,10);return n.a.createElement("image",{className:"symbol",x:a,y:r,width:10,height:10,href:t})},e}return a}(n.a.Component),y=(a(60),function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).state={textWidth:0,textHeight:0},r.componentDidMount=function(){var e=r.textRef.current.getBBox();r.setState({textWidth:e.width,textHeight:e.height})},r.render=function(){var e=r.props.coords.hourDx(13),t=r.props.coords.hourDy(13),a=1.2*r.state.textWidth,o=1.2*r.state.textHeight;return n.a.createElement(n.a.Fragment,null,n.a.createElement("rect",{x:e-a/2,y:t-o/2,width:a,height:o,rx:"2",ry:"2",className:"wind"}),n.a.createElement("text",{ref:r.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},r.props.children))},r.textRef=n.a.createRef(),r}return a}(n.a.Component)),b=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).renderTemperatures=function(e){return e.filter((function(e){return void 0!==e.celsius})).map((function(e){var t=new f(e.timestamp);return n.a.createElement(w,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})}))},e.renderWeathers=function(e){return e.filter((function(e){return void 0!==e.symbol})).map((function(e){var t=new f(e.timestamp);return n.a.createElement(v,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})}))},e.renderWindAndPrecipitation=function(t){var a=0,r=null,o=null;t.forEach((function(e){(null==r||r>e.wind_m_s)&&(r=e.wind_m_s),(null==o||o<e.wind_m_s)&&(o=e.wind_m_s),void 0!==e.precipitation_mm&&(a+=e.precipitation_mm)})),r=Math.round(r),o=Math.round(o);var i=r===o?"".concat(r," m/s"):"".concat(r,"-").concat(o," m/s");console.debug("Wind: ".concat(i));var s=navigator.language||navigator.userLanguage,c=new Intl.NumberFormat(s,{minimumFractionDigits:1,maximumFractionDigits:1}).format(a),l="".concat(c,"mm");console.debug("Precipitation: ".concat(l));var m=new f(e.props.now).rankFreeDirections(),u=m[0],d=new f(12*u/360),p=m[1],h=new f(12*p/360);return n.a.createElement(n.a.Fragment,null,n.a.createElement(y,{coords:d},i),n.a.createElement(y,{coords:h},l))},e.getForecastsToRender=function(){var t,a=[],r=e.props.now.getTime(),n=new Date(r+27e5),o=new Date(r+423e5),i=Object(g.a)(e.props.forecast.entries());try{for(i.s();!(t=i.n()).done;){var s=Object(h.a)(t.value,2),c=s[0],l=s[1],m=new Date(c);m<n||(m>o||a.push(l))}}catch(u){i.e(u)}finally{i.f()}return console.debug(a),a},e.render=function(){var t=e.getForecastsToRender();return n.a.createElement(n.a.Fragment,null,e.renderTemperatures(t),e.renderWeathers(t),e.renderWindAndPrecipitation(t))},e}return a}(n.a.Component),E=(a(61),function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:e.props.dx,y2:e.props.dy,strokeWidth:e.props.width}),n.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),n.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:e.props.dx,y2:e.props.dy,strokeWidth:e.props.width}),n.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},e}return a}(n.a.Component)),T=a(94),x=a(90),D=a(91),N=a(92),_=a(93),M=a(96),j=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){return n.a.createElement(T.a,{open:!0,onClose:e.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.a.createElement(x.a,{id:"alert-dialog-title"},e.props.title),n.a.createElement(D.a,null,n.a.createElement(N.a,{id:"alert-dialog-description"},e.props.children)),n.a.createElement(_.a,null,n.a.createElement(M.a,{onClick:e.props.reload,color:"primary",autoFocus:!0},"Retry")))},e}return a}(n.a.Component),O=a(35),k=a(95);var S=function(){function e(t){if(Object(s.a)(this,e),this._startTime=void 0,this._name=void 0,this._daysFromNow=void 0,this._daysFromNow=t,0===t)return this._startTime=new Date,void(this._name="Now");var a=new Date;if(a.setDate(a.getDate()+t),a.setHours(7),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),this._startTime=a,1!==t){var r=a.toLocaleDateString(navigator.language,{weekday:"long"});this._name=function(e){var t=e[0];return t<"\ud800"||t>"\udfff"?e[0].toUpperCase()+e.slice(1):e.slice(0,2).toUpperCase()+e.slice(2)}(r)}else this._name="Tomorrow"}return Object(O.a)(e,[{key:"name",get:function(){return this._name}},{key:"startTime",get:function(){return this._startTime}},{key:"daysFromNow",get:function(){return this._daysFromNow}}]),e}(),C=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){for(var t=[],a=0;a<3;a++){var r=new S(a).name;t.push(n.a.createElement("option",{key:r,value:String(a)},r))}return n.a.createElement(k.a,{style:{position:"absolute",right:"0px",top:"0px"},value:e.props.daysFromNow,onChange:e.onChange},t)},e.onChange=function(t){e.props.onSetStartTime(new S(parseInt(t.target.value)))},e}return a}(n.a.Component),F=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e))._getInitialState=function(){return navigator.geolocation?{startTime:r.props.startTime,progress:void 0,error:void 0}:(p.a.exception({description:"Geolocation unsupported",fatal:!0}),{startTime:r.props.startTime,progress:void 0,error:n.a.createElement(j,{title:"Geolocation unsupported",reload:r.props.reload},"Please try ",n.a.createElement("a",{href:"https://getfirefox.com"},"another browser"),".")})},r.componentDidMount=function(){r.startGeolocationIfNeeded()},r.componentDidUpdate=function(){r.props.startTime.startTime!==r.state.startTime.startTime&&r.setState(r._getInitialState()),r.startGeolocationIfNeeded()||r.state.progress||r.forecastIsCurrent()||r.download_weather()},r.startGeolocationIfNeeded=function(){if(r.state.progress)return!1;if(r.state.error)return!1;if(r.state.position){var e=Date.now()-r.state.positionTimestamp.getTime();if(e<3e5)return console.debug("Retaining cached position of ".concat(e,"ms age")),!1}return console.log("Geolocating..."),r.setState({progress:n.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(r.setPosition,r.geoError),!0},r.setPosition=function(e){var t=e.coords.latitude,a=e.coords.longitude;console.log("got position: ".concat(t," ").concat(a)),r.setState({position:e.coords,positionTimestamp:new Date}),r.forecastIsCurrent()||r.download_weather()},r.getDistanceFromLatLonInKm=function(e,t,a,n){var o=r.deg2rad(a-e),i=r.deg2rad(n-t),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r.deg2rad(e))*Math.cos(r.deg2rad(a))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},r.deg2rad=function(e){return e*(Math.PI/180)},r.forecastIsCurrent=function(){if(!r.state.forecast)return!1;var e=r.state.forecastMetadata,t=Date.now()-e.timestamp.getTime();if(t>72e5)return!1;var a=r.getDistanceFromLatLonInKm(e.latitude,e.longitude,r.state.position.latitude,r.state.position.longitude);return!(a>5)&&(console.debug("Forecast considered current: ".concat(t,"ms old and ").concat(a,"km away")),!0)},r.download_weather=function(){var e=r.state.position.latitude,t=r.state.position.longitude;r.setState({progress:n.a.createElement("text",{className:"progress"},"Downloading weather...")});var a="https://europe-west2-api-met-no-proxy.cloudfunctions.net/api-met-no-proxy/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+a);var o=Object(d.a)(r);fetch(a).then((function(e){if(!e.ok)throw new j("Response code from upstream: ".concat(e.status));return e.text()})).then((function(a){var r=o.parseWeatherXml(a);o.setState({forecast:r,forecastMetadata:{timestamp:new Date,latitude:e,longitude:t}})})).catch((function(e){console.error(e),p.a.exception({description:"Downloading weather failed: ".concat(e.message),fatal:!r.state.forecast}),r.setState({error:n.a.createElement(j,{title:"Downloading weather failed",reload:r.props.reload},e.message)})}))},r.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var a=new Map,r=0;r<t.length;r++){var n=t[r],o=new Date(n.attributes.getNamedItem("from").value),i=new Date(n.attributes.getNamedItem("to").value),s=(i.getTime()-o.getTime())/36e5,c=new Date((o.getTime()+i.getTime())/2),l=a.get(c.getTime());if(!(void 0!==l&&l.span_h<=s)){l||(l={timestamp:c,span_h:s});var m=n.getElementsByTagName("symbol");if(m&&m.length>0){var u=m[0].attributes.getNamedItem("number").value;l.symbol=u}var d=n.getElementsByTagName("temperature");if(d&&d.length>0){var p=d[0].attributes.getNamedItem("value").value;l.celsius=parseFloat(p)}var h=n.getElementsByTagName("windSpeed");if(h&&h.length>0){var g=h[0].attributes.getNamedItem("mps").value;l.wind_m_s=parseFloat(g)}var f=n.getElementsByTagName("precipitation");if(f&&f.length>0){var w=f[0].attributes.getNamedItem("maxvalue"),v=f[0].attributes.getNamedItem("value"),y=void 0===w?v.value:w.value;l.precipitation_mm=parseFloat(y)}a.set(c.getTime(),l)}}return console.log(a),a},r.geoError=function(e){console.log("Geolocation failed"),p.a.exception({description:"Geolocation failed: ".concat(e.message),fatal:!r.state.forecast}),r.setState({error:n.a.createElement(j,{title:e.message,reload:window.location.reload.bind(window.location,!0)},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},r.renderHands=function(){var e=new f(r.state.startTime.startTime);return n.a.createElement(n.a.Fragment,null,n.a.createElement(E,{width:2.5,dx:e.hourDx(23),dy:e.hourDy(23)}),n.a.createElement(E,{width:2,dx:e.minuteDx(34),dy:e.minuteDy(34)}))},r.render=function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},n.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"/weatherclock/clock-frame.png"}),r.getClockContents()),r.state.error,r.state.forecast?n.a.createElement(C,{daysFromNow:r.props.startTime.daysFromNow,onSetStartTime:r.props.onSetStartTime}):null)},r.getClockContents=function(){return r.state.forecast?0!==r.props.startTime.daysFromNow?n.a.createElement(n.a.Fragment,null,n.a.createElement(b,{forecast:r.state.forecast,now:r.state.startTime.startTime}),n.a.createElement("text",{className:"tomorrow"},r.state.startTime.name)):n.a.createElement(n.a.Fragment,null,n.a.createElement(b,{forecast:r.state.forecast,now:r.state.startTime.startTime}),r.renderHands()):r.state.error?r.renderHands():r.state.progress?r.state.progress:null},r.state=r._getInitialState(),r}return a}(n.a.Component),I=a(36);p.a.initialize("UA-59702036-2"),p.a.set({anonymizeIp:!0}),p.a.pageview(window.location.pathname+window.location.search);var H=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={startTime:new S(0)},e.setTimeToNow=function(){e.setState({startTime:new S(0)})},e.handleVisibilityChange=function(t){console.debug("Page visibility changed: ".concat(t)),t&&e.setTimeToNow()},e.onSetStartTime=function(t){u()(t),e.setState({startTime:t})},e.render=function(){return n.a.createElement(I.a,{onChange:e.handleVisibilityChange},n.a.createElement("div",{className:"App"},n.a.createElement(F,{startTime:e.state.startTime,reload:e.setTimeToNow,onSetStartTime:e.onSetStartTime}),n.a.createElement("button",{type:"button",onClick:e.setTimeToNow},"Update forecast"),n.a.createElement("p",null,"Weather forecast from ",n.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",n.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," ","and the ",n.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),n.a.createElement("p",null,n.a.createElement("a",{href:"https://github.com/walles/weatherclock/tree/".concat("e447e626accf778f791b4c508ee2998341faa773")},"Source code on GitHub"))))},e}return a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var P=window.location.protocol;"http:"===P&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(P.length):(i.a.render(n.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})))}},[[44,1,2]]]);
//# sourceMappingURL=main.e9c58875.chunk.js.map