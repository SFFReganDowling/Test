(window.webpackJsonpweatherclock=window.webpackJsonpweatherclock||[]).push([[0],{39:function(e,t,n){e.exports=n(54)},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),i=n.n(o),c=(n(44),n(6)),s=n(7),l=n(8),u=n(9),m=(n(45),n(16)),h=(n(46),n(32)),d=(n(47),function e(t){var n=this;if(Object(c.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(n.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(n.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(n.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(n.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var a=2*Math.PI*(n.decimalHour/12);return Math.sin(a)*e-(t-1)/2},this.symbolDy=function(e,t){var a=2*Math.PI*(n.decimalHour/12);return-Math.cos(a)*e-(t-1)/2},this.isNight=function(){return n.decimalHour<7||n.decimalHour>20},this._degreesDistance=function(e,t){var n=Math.abs(t-e);return n>180?360-n:n},this.rankFreeDirections=function(){var e=[0,90,180,270],t=n.decimalHour%1*360,a=n.decimalHour%12/12*360,r={};return e.forEach(function(e){var o=n._degreesDistance(e,t),i=n._degreesDistance(e,a);r[e]=Math.min(o,i)}),e.sort(function(e,t){var n=r[e],a=r[t];return n<a?1:n>a?-1:0}),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60}}),p=39,f=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e=0|n.props.degreesCelsius,t=n.props.coordinates.hourDx(p),a=n.props.coordinates.hourDy(p);return r.a.createElement("text",{className:"hour",x:t,y:a},e,"\xb0")},n}return Object(u.a)(t,e),t}(r.a.Component),g=29,w=10,v=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+n.props.symbol+";content_type=image/png;is_night="+(n.props.coordinates.isNight()?1:0),t=n.props.coordinates.symbolDx(g,w),a=n.props.coordinates.symbolDy(g,w);return r.a.createElement("image",{className:"symbol",x:t,y:a,width:w,height:w,href:e})},n}return Object(u.a)(t,e),t}(r.a.Component),b=(n(48),13),y=1.2,E=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).state={textWidth:0,textHeight:0},n.componentDidMount=function(){var e=n.textRef.current.getBBox();n.setState({textWidth:e.width,textHeight:e.height})},n.render=function(){var e=n.props.coords.hourDx(b),t=n.props.coords.hourDy(b),a=n.state.textWidth*y,o=n.state.textHeight*y;return r.a.createElement(r.a.Fragment,null,r.a.createElement("rect",{x:e-a/2,y:t-o/2,width:a,height:o,rx:"2",ry:"2",className:"wind"}),r.a.createElement("text",{ref:n.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},n.props.children))},n.textRef=r.a.createRef(),n}return Object(u.a)(t,e),t}(r.a.Component),x=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).renderTemperatures=function(e){return e.filter(function(e){return void 0!==e.celsius}).map(function(e){var t=new d(e.timestamp);return r.a.createElement(f,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})})},n.renderWeathers=function(e){return e.filter(function(e){return void 0!==e.symbol}).map(function(e){var t=new d(e.timestamp);return r.a.createElement(v,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})})},n.renderWindAndPrecipitation=function(e){var t=0,a=null,o=null;e.forEach(function(e){(null==a||a>e.wind_m_s)&&(a=e.wind_m_s),(null==o||o<e.wind_m_s)&&(o=e.wind_m_s),void 0!==e.precipitation_mm&&(t+=e.precipitation_mm)}),a=Math.round(a),o=Math.round(o);var i=a===o?"".concat(a," m/s"):"".concat(a,"-").concat(o," m/s");console.log("Wind: ".concat(i));var c=navigator.language||navigator.userLanguage,s=new Intl.NumberFormat(c,{minimumSignificantDigits:2}).format(t),l="".concat(s,"mm");console.log("Precipitation: ".concat(l));var u=new d(n.props.now).rankFreeDirections(),m=u[0],h=new d(12*m/360),p=u[1],f=new d(12*p/360);return r.a.createElement(r.a.Fragment,null,r.a.createElement(E,{coords:h},i),r.a.createElement(E,{coords:f},l))},n.getForecastsToRender=function(){for(var e=[],t=n.props.now.getTime(),a=new Date(t+27e5),r=new Date(t+423e5),o=0,i=Object.entries(n.props.forecast);o<i.length;o++){var c=i[o],s=Object(h.a)(c,2),l=s[0],u=s[1],m=new Date(l);m<a||(m>r||e.push(u))}return console.log(e),e},n.render=function(){var e=n.getForecastsToRender();return r.a.createElement(r.a.Fragment,null,n.renderTemperatures(e),n.renderWeathers(e),n.renderWindAndPrecipitation(e))},n}return Object(u.a)(t,e),t}(r.a.Component),D=(n(49),function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:n.props.dx,y2:n.props.dy,strokeWidth:n.props.width}),r.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),r.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:n.props.dx,y2:n.props.dy,strokeWidth:n.props.width}),r.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},n}return Object(u.a)(t,e),t}(r.a.Component)),j=n(79),O=n(75),k=n(76),N=n(77),_=n(78),H=n(80),T=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(j.a,{open:!0,onClose:n.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(O.a,{id:"alert-dialog-title"},n.props.title),r.a.createElement(k.a,null,r.a.createElement(N.a,{id:"alert-dialog-description"},n.props.children)),r.a.createElement(_.a,null,r.a.createElement(H.a,{onClick:n.props.reload,color:"primary",autoFocus:!0},"Retry")))},n}return Object(u.a)(t,e),t}(r.a.Component),M=23,C=34,F=3e5,I=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e)))._getInitialState=function(){return navigator.geolocation?{now:n.props.now,progress:null,error:null}:{now:n.props.now,progress:null,error:r.a.createElement(T,{title:"Geolocation unsupported",reload:n.props.reload},"Please try ",r.a.createElement("a",{href:"https://getfirefox.com"},"another browser"),".")}},n.componentDidMount=function(){n.startGeolocationIfNeeded()},n.componentDidUpdate=function(){n.props.now!==n.state.now&&n.setState(n._getInitialState()),n.startGeolocationIfNeeded()},n.startGeolocationIfNeeded=function(){if(n.state.position){var e=new Date-n.state.positionTimestamp;if(e<F)return void console.log("Retaining cached position of ".concat(e,"ms age"))}n.state.progress||n.state.error||(console.log("Geolocating..."),n.setState({progress:r.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(n.setPosition,n.geoError))},n.setPosition=function(e){var t=e.coords.latitude,a=e.coords.longitude;console.log("got position: ".concat(t," ").concat(a)),n.setState({position:e.coords,positionTimestamp:new Date}),n.download_weather(t,a)},n.download_weather=function(e,t){n.setState({progress:r.a.createElement("text",{className:"progress"},"Downloading weather...")});var a="https://api-met-no-proxy.appspot.com/weatherapi/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+a);var o=Object(m.a)(n);fetch(a).then(function(e){if(!e.ok)throw new T("Response code from upstream: ".concat(e.status));return e.text()}).then(function(e){var t=o.parseWeatherXml(e);o.setState({forecast:t})}).catch(function(e){n.setState({error:r.a.createElement(T,{title:"Downloading weather failed",reload:n.props.reload},e.message)})})},n.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var n={},a=0;a<t.length;a++){var r=t[a],o=new Date(r.attributes.from.value),i=new Date(r.attributes.to.value),c=(i.getTime()-o.getTime())/36e5,s=new Date((o.getTime()+i.getTime())/2),l=n[s];if(l||(l={}),l.timestamp=s,!(void 0!==l.span_h&&l.span_h<=c)){l.span_h=c;var u=r.getElementsByTagName("symbol");if(u&&u.length>0){var m=u[0].attributes.number.value;l.symbol=m}var h=r.getElementsByTagName("temperature");if(h&&h.length>0){var d=h[0].attributes.value.value;l.celsius=parseFloat(d)}var p=r.getElementsByTagName("windSpeed");if(p&&p.length>0){var f=p[0].attributes.mps.value;l.wind_m_s=parseFloat(f)}var g=r.getElementsByTagName("precipitation");if(g&&g.length>0){var w=g[0].attributes.value.value;l.precipitation_mm=parseFloat(w)}n[s]=l}}return n},n.geoError=function(e){console.log("Geolocation failed"),n.setState({error:r.a.createElement(T,{title:e.message,reload:window.location.reload.bind(window.location,[!0])},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},n.renderHands=function(){var e=new d(n.state.now);return r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{width:2.5,dx:e.hourDx(M),dy:e.hourDy(M)}),r.a.createElement(D,{width:2,dx:e.minuteDx(C),dy:e.minuteDy(C)}))},n.render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},r.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"clock-frame.png"}),n.getClockContents()),n.state.error)},n.getClockContents=function(){return n.state.error?n.renderHands():n.state.forecast?r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{forecast:n.state.forecast,now:n.state.now}),n.renderHands()):n.state.progress?n.state.progress:null},n.state=n._getInitialState(),n}return Object(u.a)(t,e),t}(r.a.Component),S=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={now:new Date},n.setTimeToNow=function(){n.setState({now:new Date})},n.render=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(I,{now:n.state.now,reload:n.setTimeToNow}),r.a.createElement("button",{type:"button",onClick:n.setTimeToNow},"Update forecast"),r.a.createElement("p",null,"Weather forecast from ",r.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",r.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," and the"," ",r.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),r.a.createElement("p",null,"Imagine a share-on-Facebook button here"),r.a.createElement("p",null,r.a.createElement("a",{href:"https://github.com/walles/weatherclock"},"Source code on GitHub")))},n}return Object(u.a)(t,e),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var W=window.location.protocol;"http:"===W&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(W.length):(i.a.render(r.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[39,1,2]]]);
//# sourceMappingURL=main.1bad934c.chunk.js.map