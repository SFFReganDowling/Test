(window.webpackJsonpweatherclock=window.webpackJsonpweatherclock||[]).push([[0],{40:function(e,t,a){e.exports=a(55)},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},55:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),i=a.n(o),c=(a(45),a(6)),s=a(7),l=a(8),u=a(9),d=(a(46),a(16)),m=(a(47),a(33)),h=(a(48),function e(t){var a=this;if(Object(c.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(a.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(a.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(a.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(a.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return Math.sin(n)*e-(t-1)/2},this.symbolDy=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return-Math.cos(n)*e-(t-1)/2},this.isNight=function(){return a.decimalHour<7||a.decimalHour>20},this._degreesDistance=function(e,t){var a=Math.abs(t-e);return a>180?360-a:a},this.rankFreeDirections=function(){var e=[0,90,180,270],t=a.decimalHour%1*360,n=a.decimalHour%12/12*360,r={};return e.forEach(function(e){var o=a._degreesDistance(e,t),i=a._degreesDistance(e,n);r[e]=Math.min(o,i)}),e.sort(function(e,t){var a=r[e],n=r[t];return a<n?1:a>n?-1:0}),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60+t.getSeconds()/3600}}),p=39,g=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e=0|a.props.degreesCelsius,t=a.props.coordinates.hourDx(p),n=a.props.coordinates.hourDy(p);return r.a.createElement("text",{className:"hour",x:t,y:n},e,"\xb0")},a}return Object(u.a)(t,e),t}(r.a.Component),f=29,w=10,v=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){var e="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+a.props.symbol+";content_type=image/png;is_night="+(a.props.coordinates.isNight()?1:0),t=a.props.coordinates.symbolDx(f,w),n=a.props.coordinates.symbolDy(f,w);return r.a.createElement("image",{className:"symbol",x:t,y:n,width:w,height:w,href:e})},a}return Object(u.a)(t,e),t}(r.a.Component),b=(a(49),13),y=1.2,E=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(s.a)(this,Object(l.a)(t).call(this,e))).state={textWidth:0,textHeight:0},a.componentDidMount=function(){var e=a.textRef.current.getBBox();a.setState({textWidth:e.width,textHeight:e.height})},a.render=function(){var e=a.props.coords.hourDx(b),t=a.props.coords.hourDy(b),n=a.state.textWidth*y,o=a.state.textHeight*y;return r.a.createElement(r.a.Fragment,null,r.a.createElement("rect",{x:e-n/2,y:t-o/2,width:n,height:o,rx:"2",ry:"2",className:"wind"}),r.a.createElement("text",{ref:a.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},a.props.children))},a.textRef=r.a.createRef(),a}return Object(u.a)(t,e),t}(r.a.Component),x=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).renderTemperatures=function(e){return e.filter(function(e){return void 0!==e.celsius}).map(function(e){var t=new h(e.timestamp);return r.a.createElement(g,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})})},a.renderWeathers=function(e){return e.filter(function(e){return void 0!==e.symbol}).map(function(e){var t=new h(e.timestamp);return r.a.createElement(v,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})})},a.renderWindAndPrecipitation=function(e){var t=0,n=null,o=null;e.forEach(function(e){(null==n||n>e.wind_m_s)&&(n=e.wind_m_s),(null==o||o<e.wind_m_s)&&(o=e.wind_m_s),void 0!==e.precipitation_mm&&(t+=e.precipitation_mm)}),n=Math.round(n),o=Math.round(o);var i=n===o?"".concat(n," m/s"):"".concat(n,"-").concat(o," m/s");console.debug("Wind: ".concat(i));var c=navigator.language||navigator.userLanguage,s=new Intl.NumberFormat(c,{minimumSignificantDigits:2}).format(t),l="".concat(s,"mm");console.debug("Precipitation: ".concat(l));var u=new h(a.props.now).rankFreeDirections(),d=u[0],m=new h(12*d/360),p=u[1],g=new h(12*p/360);return r.a.createElement(r.a.Fragment,null,r.a.createElement(E,{coords:m},i),r.a.createElement(E,{coords:g},l))},a.getForecastsToRender=function(){for(var e=[],t=a.props.now.getTime(),n=new Date(t+27e5),r=new Date(t+423e5),o=0,i=Object.entries(a.props.forecast);o<i.length;o++){var c=i[o],s=Object(m.a)(c,2),l=s[0],u=s[1],d=new Date(l);d<n||(d>r||e.push(u))}return console.debug(e),e},a.render=function(){var e=a.getForecastsToRender();return r.a.createElement(r.a.Fragment,null,a.renderTemperatures(e),a.renderWeathers(e),a.renderWindAndPrecipitation(e))},a}return Object(u.a)(t,e),t}(r.a.Component),D=(a(50),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:a.props.dx,y2:a.props.dy,strokeWidth:a.props.width}),r.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),r.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:a.props.dx,y2:a.props.dy,strokeWidth:a.props.width}),r.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},a}return Object(u.a)(t,e),t}(r.a.Component)),j=a(80),O=a(76),M=a(77),N=a(78),_=a(79),k=a(81),C=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(j.a,{open:!0,onClose:a.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(O.a,{id:"alert-dialog-title"},a.props.title),r.a.createElement(M.a,null,r.a.createElement(N.a,{id:"alert-dialog-description"},a.props.children)),r.a.createElement(_.a,null,r.a.createElement(k.a,{onClick:a.props.reload,color:"primary",autoFocus:!0},"Retry")))},a}return Object(u.a)(t,e),t}(r.a.Component),T=23,H=34,I=3e5,F=72e5,P=5,S=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(s.a)(this,Object(l.a)(t).call(this,e)))._getInitialState=function(){return navigator.geolocation?{now:a.props.now,progress:null,error:null}:{now:a.props.now,progress:null,error:r.a.createElement(C,{title:"Geolocation unsupported",reload:a.props.reload},"Please try ",r.a.createElement("a",{href:"https://getfirefox.com"},"another browser"),".")}},a.componentDidMount=function(){a.startGeolocationIfNeeded()},a.componentDidUpdate=function(){a.props.now!==a.state.now&&a.setState(a._getInitialState()),a.startGeolocationIfNeeded()||a.state.progress||a.forecastIsCurrent()||a.download_weather()},a.startGeolocationIfNeeded=function(){if(a.state.progress)return!1;if(a.state.error)return!1;if(a.state.position){var e=new Date-a.state.positionTimestamp;if(e<I)return console.debug("Retaining cached position of ".concat(e,"ms age")),!1}return console.log("Geolocating..."),a.setState({progress:r.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(a.setPosition,a.geoError),!0},a.setPosition=function(e){var t=e.coords.latitude,n=e.coords.longitude;console.log("got position: ".concat(t," ").concat(n)),a.setState({position:e.coords,positionTimestamp:new Date}),a.forecastIsCurrent()||a.download_weather()},a.getDistanceFromLatLonInKm=function(e,t,n,r){var o=a.deg2rad(n-e),i=a.deg2rad(r-t),c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(a.deg2rad(e))*Math.cos(a.deg2rad(n))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},a.deg2rad=function(e){return e*(Math.PI/180)},a.forecastIsCurrent=function(){if(!a.state.forecast)return!1;var e=a.state.forecastMetadata,t=new Date-e.timestamp;if(t>F)return!1;var n=a.getDistanceFromLatLonInKm(e.latitude,e.longitude,a.state.position.latitude,a.state.position.longitude);return!(n>P)&&(console.debug("Forecast considered current: ".concat(t,"ms old and ").concat(n,"km away")),!0)},a.download_weather=function(){var e=a.state.position.latitude,t=a.state.position.longitude;a.setState({progress:r.a.createElement("text",{className:"progress"},"Downloading weather...")});var n="https://api-met-no-proxy.appspot.com/weatherapi/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+n);var o=Object(d.a)(a);fetch(n).then(function(e){if(!e.ok)throw new C("Response code from upstream: ".concat(e.status));return e.text()}).then(function(a){var n=o.parseWeatherXml(a);o.setState({forecast:n,forecastMetadata:{timestamp:new Date,latitude:e,longitude:t}})}).catch(function(e){a.setState({error:r.a.createElement(C,{title:"Downloading weather failed",reload:a.props.reload},e.message)})})},a.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var a={},n=0;n<t.length;n++){var r=t[n],o=new Date(r.attributes.from.value),i=new Date(r.attributes.to.value),c=(i.getTime()-o.getTime())/36e5,s=new Date((o.getTime()+i.getTime())/2),l=a[s];if(l||(l={}),l.timestamp=s,!(void 0!==l.span_h&&l.span_h<=c)){l.span_h=c;var u=r.getElementsByTagName("symbol");if(u&&u.length>0){var d=u[0].attributes.number.value;l.symbol=d}var m=r.getElementsByTagName("temperature");if(m&&m.length>0){var h=m[0].attributes.value.value;l.celsius=parseFloat(h)}var p=r.getElementsByTagName("windSpeed");if(p&&p.length>0){var g=p[0].attributes.mps.value;l.wind_m_s=parseFloat(g)}var f=r.getElementsByTagName("precipitation");if(f&&f.length>0){var w=f[0].attributes.value.value;l.precipitation_mm=parseFloat(w)}a[s]=l}}return console.log(a),a},a.geoError=function(e){console.log("Geolocation failed"),a.setState({error:r.a.createElement(C,{title:e.message,reload:window.location.reload.bind(window.location,[!0])},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},a.renderHands=function(){var e=new h(a.state.now);return r.a.createElement(r.a.Fragment,null,r.a.createElement(D,{width:2.5,dx:e.hourDx(T),dy:e.hourDy(T)}),r.a.createElement(D,{width:2,dx:e.minuteDx(H),dy:e.minuteDy(H)}))},a.render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},r.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"clock-frame.png"}),a.getClockContents()),a.state.error)},a.getClockContents=function(){return a.state.forecast?r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{forecast:a.state.forecast,now:a.state.now}),a.renderHands()):a.state.error?a.renderHands():a.state.progress?a.state.progress:null},a.state=a._getInitialState(),a}return Object(u.a)(t,e),t}(r.a.Component),W=a(32),B=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={now:new Date},a.setTimeToNow=function(){a.setState({now:new Date})},a.handleVisibilityChange=function(e){console.debug("Page visibility changed: ".concat(e)),e&&a.setTimeToNow()},a.render=function(){return r.a.createElement(W.a,{onChange:a.handleVisibilityChange},r.a.createElement("div",{className:"App"},r.a.createElement(S,{now:a.state.now,reload:a.setTimeToNow}),r.a.createElement("button",{type:"button",onClick:a.setTimeToNow},"Update forecast"),r.a.createElement("p",null,"Weather forecast from ",r.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",r.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," and the"," ",r.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),r.a.createElement("p",null,r.a.createElement("a",{href:"https://github.com/walles/weatherclock"},"Source code on GitHub"))))},a}return Object(u.a)(t,e),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=window.location.protocol;"http:"===A&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(A.length):(i.a.render(r.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[40,1,2]]]);
//# sourceMappingURL=main.2e37c044.chunk.js.map