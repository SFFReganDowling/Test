(this.webpackJsonpweatherclock=this.webpackJsonpweatherclock||[]).push([[0],{40:function(e,t,a){e.exports=a(55)},45:function(e,t,a){},46:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},55:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),i=a.n(o),s=(a(45),a(7)),c=a(9),l=a(8),u=(a(46),a(26)),m=a(18),d=(a(49),a(32)),p=(a(50),function e(t){var a=this;if(Object(s.a)(this,e),this.hourDx=function(e){var t=2*Math.PI*(a.decimalHour/12);return Math.sin(t)*e},this.hourDy=function(e){var t=2*Math.PI*(a.decimalHour/12);return-Math.cos(t)*e},this.minuteDx=function(e){var t=2*Math.PI*(a.decimalHour%12);return Math.sin(t)*e},this.minuteDy=function(e){var t=2*Math.PI*(a.decimalHour%12);return-Math.cos(t)*e},this.symbolDx=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return Math.sin(n)*e-(t-1)/2},this.symbolDy=function(e,t){var n=2*Math.PI*(a.decimalHour/12);return-Math.cos(n)*e-(t-1)/2},this.isNight=function(){return a.decimalHour<7||a.decimalHour>20},this._degreesDistance=function(e,t){var a=Math.abs(t-e);return a>180?360-a:a},this.rankFreeDirections=function(){var e=[0,90,180,270],t=a.decimalHour%1*360,n=a.decimalHour%12/12*360,r={};return e.forEach((function(e){var o=a._degreesDistance(e,t),i=a._degreesDistance(e,n);r[e]=Math.min(o,i)})),e.sort((function(e,t){var a=r[e],n=r[t];return a<n?1:a>n?-1:0})),e},"number"===typeof t)this.decimalHour=t;else{if("object"!==typeof t||"Date"!==t.constructor.name)throw new TypeError("Expected number (decimal hours) or Date");this.decimalHour=t.getHours()+t.getMinutes()/60+t.getSeconds()/3600}}),h=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){var t=0|e.props.degreesCelsius,a=e.props.coordinates.hourDx(39),n=e.props.coordinates.hourDy(39);return r.a.createElement("text",{className:"hour",x:a,y:n},t,"\xb0")},e}return a}(r.a.Component),f=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){var t="https://api.met.no/weatherapi/weathericon/1.1/?symbol="+e.props.symbol+";content_type=image/png;is_night="+(e.props.coordinates.isNight()?1:0),a=e.props.coordinates.symbolDx(29,10),n=e.props.coordinates.symbolDy(29,10);return r.a.createElement("image",{className:"symbol",x:a,y:n,width:10,height:10,href:t})},e}return a}(r.a.Component),w=(a(51),function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={textWidth:0,textHeight:0},n.componentDidMount=function(){var e=n.textRef.current.getBBox();n.setState({textWidth:e.width,textHeight:e.height})},n.render=function(){var e=n.props.coords.hourDx(13),t=n.props.coords.hourDy(13),a=1.2*n.state.textWidth,o=1.2*n.state.textHeight;return r.a.createElement(r.a.Fragment,null,r.a.createElement("rect",{x:e-a/2,y:t-o/2,width:a,height:o,rx:"2",ry:"2",className:"wind"}),r.a.createElement("text",{ref:n.textRef,x:e,y:t,className:"wind",dominantBaseline:"middle",textAnchor:"middle"},n.props.children))},n.textRef=r.a.createRef(),n}return a}(r.a.Component)),g=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).renderTemperatures=function(e){return e.filter((function(e){return void 0!==e.celsius})).map((function(e){var t=new p(e.timestamp);return r.a.createElement(h,{key:"hour-".concat(t.decimalHour),coordinates:t,degreesCelsius:e.celsius})}))},e.renderWeathers=function(e){return e.filter((function(e){return void 0!==e.symbol})).map((function(e){var t=new p(e.timestamp);return r.a.createElement(f,{key:"weather-".concat(t.decimalHour),coordinates:t,symbol:e.symbol})}))},e.renderWindAndPrecipitation=function(t){var a=0,n=null,o=null;t.forEach((function(e){(null==n||n>e.wind_m_s)&&(n=e.wind_m_s),(null==o||o<e.wind_m_s)&&(o=e.wind_m_s),void 0!==e.precipitation_mm&&(a+=e.precipitation_mm)})),n=Math.round(n),o=Math.round(o);var i=n===o?"".concat(n," m/s"):"".concat(n,"-").concat(o," m/s");console.debug("Wind: ".concat(i));var s=navigator.language||navigator.userLanguage,c=new Intl.NumberFormat(s,{minimumFractionDigits:1,maximumFractionDigits:1}).format(a),l="".concat(c,"mm");console.debug("Precipitation: ".concat(l));var u=new p(e.props.now).rankFreeDirections(),m=u[0],d=new p(12*m/360),h=u[1],f=new p(12*h/360);return r.a.createElement(r.a.Fragment,null,r.a.createElement(w,{coords:d},i),r.a.createElement(w,{coords:f},l))},e.getForecastsToRender=function(){for(var t=[],a=e.props.now.getTime(),n=new Date(a+27e5),r=new Date(a+423e5),o=0,i=Object.entries(e.props.forecast);o<i.length;o++){var s=Object(d.a)(i[o],2),c=s[0],l=s[1],u=new Date(c);u<n||(u>r||t.push(l))}return console.debug(t),t},e.render=function(){var t=e.getForecastsToRender();return r.a.createElement(r.a.Fragment,null,e.renderTemperatures(t),e.renderWeathers(t),e.renderWindAndPrecipitation(t))},e}return a}(r.a.Component),v=(a(52),function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("line",{className:"hand shadow",x1:"0",y1:"0",x2:e.props.dx,y2:e.props.dy,strokeWidth:e.props.width}),r.a.createElement("circle",{className:"shadow",cx:"0",cy:"0",r:"2"}),r.a.createElement("line",{className:"hand",x1:"0",y1:"0",x2:e.props.dx,y2:e.props.dy,strokeWidth:e.props.width}),r.a.createElement("circle",{cx:"0",cy:"0",r:"2"}))},e}return a}(r.a.Component)),b=a(88),y=a(84),E=a(85),x=a(86),D=a(87),T=a(90),O=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){return r.a.createElement(b.a,{open:!0,onClose:e.props.reload,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(y.a,{id:"alert-dialog-title"},e.props.title),r.a.createElement(E.a,null,r.a.createElement(x.a,{id:"alert-dialog-description"},e.props.children)),r.a.createElement(D.a,null,r.a.createElement(T.a,{onClick:e.props.reload,color:"primary",autoFocus:!0},"Retry")))},e}return a}(r.a.Component),M=a(89),j=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).render=function(){return r.a.createElement(M.a,{style:{position:"absolute",right:"0px",top:"0px"},value:e.props.value,onChange:e.onChange},r.a.createElement("option",{value:"now"},"Now"),r.a.createElement("option",{value:"tomorrow"},"Tomorrow"))},e.onChange=function(t){e.props.onSetTimespan(t.target.value)},e}return a}(r.a.Component),C=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e))._getInitialState=function(){return navigator.geolocation?{now:n.props.now,progress:null,error:null}:(m.a.exception({description:"Geolocation unsupported",fatal:!0}),{now:n.props.now,progress:null,error:r.a.createElement(O,{title:"Geolocation unsupported",reload:n.props.reload},"Please try ",r.a.createElement("a",{href:"https://getfirefox.com"},"another browser"),".")})},n.componentDidMount=function(){n.startGeolocationIfNeeded()},n.componentDidUpdate=function(){n.props.now!==n.state.now&&n.setState(n._getInitialState()),n.startGeolocationIfNeeded()||n.state.progress||n.forecastIsCurrent()||n.download_weather()},n.startGeolocationIfNeeded=function(){if(n.state.progress)return!1;if(n.state.error)return!1;if(n.state.position){var e=new Date-n.state.positionTimestamp;if(e<3e5)return console.debug("Retaining cached position of ".concat(e,"ms age")),!1}return console.log("Geolocating..."),n.setState({progress:r.a.createElement("text",{className:"progress"},"Locating phone...")}),navigator.geolocation.getCurrentPosition(n.setPosition,n.geoError),!0},n.setPosition=function(e){var t=e.coords.latitude,a=e.coords.longitude;console.log("got position: ".concat(t," ").concat(a)),n.setState({position:e.coords,positionTimestamp:new Date}),n.forecastIsCurrent()||n.download_weather()},n.getDistanceFromLatLonInKm=function(e,t,a,r){var o=n.deg2rad(a-e),i=n.deg2rad(r-t),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n.deg2rad(e))*Math.cos(n.deg2rad(a))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},n.deg2rad=function(e){return e*(Math.PI/180)},n.forecastIsCurrent=function(){if(!n.state.forecast)return!1;var e=n.state.forecastMetadata,t=new Date-e.timestamp;if(t>72e5)return!1;var a=n.getDistanceFromLatLonInKm(e.latitude,e.longitude,n.state.position.latitude,n.state.position.longitude);return!(a>5)&&(console.debug("Forecast considered current: ".concat(t,"ms old and ").concat(a,"km away")),!0)},n.download_weather=function(){var e=n.state.position.latitude,t=n.state.position.longitude;n.setState({progress:r.a.createElement("text",{className:"progress"},"Downloading weather...")});var a="https://api-met-no-proxy.appspot.com/weatherapi/locationforecast/1.9/?lat=".concat(e,";lon=").concat(t);console.log("Getting weather from: "+a);var o=Object(u.a)(n);fetch(a).then((function(e){if(!e.ok)throw new O("Response code from upstream: ".concat(e.status));return e.text()})).then((function(a){var n=o.parseWeatherXml(a);o.setState({forecast:n,forecastMetadata:{timestamp:new Date,latitude:e,longitude:t}})})).catch((function(e){m.a.exception({description:"Downloading weather failed: ".concat(e.message),fatal:!n.state.forecast}),n.setState({error:r.a.createElement(O,{title:"Downloading weather failed",reload:n.props.reload},e.message)})}))},n.parseWeatherXml=function(e){var t=(new window.DOMParser).parseFromString(e,"text/xml").getElementsByTagName("time");console.log("Parsing "+t.length+" prognoses...");for(var a={},n=0;n<t.length;n++){var r=t[n],o=new Date(r.attributes.from.value),i=new Date(r.attributes.to.value),s=(i.getTime()-o.getTime())/36e5,c=new Date((o.getTime()+i.getTime())/2),l=a[c];if(l||(l={}),l.timestamp=c,!(void 0!==l.span_h&&l.span_h<=s)){l.span_h=s;var u=r.getElementsByTagName("symbol");if(u&&u.length>0){var m=u[0].attributes.number.value;l.symbol=m}var d=r.getElementsByTagName("temperature");if(d&&d.length>0){var p=d[0].attributes.value.value;l.celsius=parseFloat(p)}var h=r.getElementsByTagName("windSpeed");if(h&&h.length>0){var f=h[0].attributes.mps.value;l.wind_m_s=parseFloat(f)}var w=r.getElementsByTagName("precipitation");if(w&&w.length>0){var g=w[0].attributes.maxvalue,v=w[0].attributes.value,b=void 0===g?v.value:g.value;l.precipitation_mm=parseFloat(b)}a[c]=l}}return console.log(a),a},n.geoError=function(e){console.log("Geolocation failed"),m.a.exception({description:"Geolocation failed: ".concat(e.message),fatal:!n.state.forecast}),n.setState({error:r.a.createElement(O,{title:e.message,reload:window.location.reload.bind(window.location,[!0])},'If you are asked whether to allow the Weather Clock to know your current location, please say "yes".')})},n.renderHands=function(){var e=new p(n.state.now);return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{width:2.5,dx:e.hourDx(23),dy:e.hourDy(23)}),r.a.createElement(v,{width:2,dx:e.minuteDx(34),dy:e.minuteDy(34)}))},n.render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{id:"weatherclock",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100"},r.a.createElement("image",{x:"-50",y:"-50",width:"100",height:"100",xlinkHref:"/weatherclock/clock-frame.png"}),n.getClockContents()),n.state.error,n.state.forecast?r.a.createElement(j,{value:n.props.nowOrTomorrow,onSetTimespan:n.props.onSetTimespan}):null)},n.getClockContents=function(){return n.state.forecast?"tomorrow"===n.props.nowOrTomorrow?r.a.createElement(r.a.Fragment,null,r.a.createElement(g,{forecast:n.state.forecast,now:n.state.now}),r.a.createElement("text",{className:"tomorrow"},"Tomorrow")):r.a.createElement(r.a.Fragment,null,r.a.createElement(g,{forecast:n.state.forecast,now:n.state.now}),n.renderHands()):n.state.error?n.renderHands():n.state.progress?n.state.progress:null},n.state=n._getInitialState(),n}return a}(r.a.Component),N=a(33);m.a.initialize("UA-59702036-2"),m.a.set({anonymizeIp:!0}),m.a.pageview(window.location.pathname+window.location.search);var k=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={now:new Date,nowOrTomorrow:"now"},e.setTimeToNow=function(){e.setState({now:new Date,nowOrTomorrow:"now"})},e.handleVisibilityChange=function(t){console.debug("Page visibility changed: ".concat(t)),t&&e.setTimeToNow()},e.onSetTimespan=function(t){if("now"===t)e.setState({nowOrTomorrow:"now",now:new Date});else{var a=new Date;a.setDate(a.getDate()+1),a.setHours(7),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),e.setState({nowOrTomorrow:"tomorrow",now:a})}},e.render=function(){return r.a.createElement(N.a,{onChange:e.handleVisibilityChange},r.a.createElement("div",{className:"App"},r.a.createElement(C,{now:e.state.now,reload:e.setTimeToNow,onSetTimespan:e.onSetTimespan,nowOrTomorrow:e.state.nowOrTomorrow}),r.a.createElement("button",{type:"button",onClick:e.setTimeToNow},"Update forecast"),r.a.createElement("p",null,"Weather forecast from ",r.a.createElement("a",{href:"yr.no"},"yr.no"),", delivered by the"," ",r.a.createElement("a",{href:"https://met.no/English/"},"Norwegian Meteorological Institute")," ","and the ",r.a.createElement("a",{href:"https://www.nrk.no/"},"NRK"),"."),r.a.createElement("p",null,r.a.createElement("a",{href:"https://github.com/walles/weatherclock/tree/".concat("7a28bf9da46f744a9fb295bad42d01038e66d0bf")},"Source code on GitHub"))))},e}return a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var _=window.location.protocol;"http:"===_&&"localhost"!==window.location.hostname?window.location.href="https:"+window.location.href.substring(_.length):(i.a.render(r.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})))}},[[40,1,2]]]);
//# sourceMappingURL=main.fafc93c4.chunk.js.map